<h4><%= current_project.title %> - <%= current_component %></h4>
<div class="tabs">
  <ul>
    <li>
      <a href="#tabs-1">Cocomo Advanced</a>
    </li>
  </ul>

  <div id="tabs-1" style="overflow-x: auto;">
    <%= form_tag "/cocomo_advanced/cocomo_save" do %>
      <table class="table table-bordered table-condensed">
        <tr>
          <th>Nom</th>
          <th>Description</th>
          <th>Valeur</th>
          <th></th>
        </tr>

        <tr>
          <td colspan="3" style="text-align: center">
            <b>
              Attribut produit
            </b>
          </td>
        </tr>

        <% @aprod.compact.each do |factor| %>
          <% selected = InputCocomo.where(factor_id: factor.id, pbs_project_element_id: current_component.id, project_id: current_project.id).first %>
          <% default = OrganizationUowComplexity.where(factor_id: factor.id, is_default: true).first %>
          <tr>
            <td><%= factor.name %></td>
            <td><%= factor.description %></td>
            <td><%= select_tag "factors[#{factor.id}]", options_for_select(factor.organization_uow_complexities.where(organization_id: current_project.organization.id).map{|i| [i.name, i.id]}, selected: selected.nil? ? (default.nil? ? '' : default.id) : (selected.organization_uow_complexity_id)) %></td>
            <td>
              <%= link_to "", cocomo_advanced.help_path(factor.id), remote: true, class: "icon icon-list-alt" %> |
              <%= link_to "", cocomo_advanced.add_note_to_factor_path(factor.id), remote: true, class: "icon icon-edit" %>
            </td>
          </tr>
        <% end %>

        <tr>
          <td colspan="4" style="text-align: center">
            <b>
              Attribut plateforme
            </b>
          </td>
        </tr>

        <% @aplat.compact.each do |factor| %>
          <% selected = InputCocomo.where(factor_id: factor.id, pbs_project_element_id: current_component.id, project_id: current_project.id).first %>
          <% default = OrganizationUowComplexity.where(factor_id: factor.id, is_default: true).first %>
          <tr>
            <td><%= factor.name %></td>
            <td><%= factor.description %></td>
            <td><%= select_tag "factors[#{factor.id}]", options_for_select(factor.organization_uow_complexities.where(organization_id: current_project.organization.id).map{|i| [i.name, i.id]}, selected: selected.nil? ? (default.nil? ? '' : default.id) : (selected.organization_uow_complexity_id)) %></td>
            <td>
              <%= link_to "", cocomo_advanced.help_path(factor.id), remote: true, class: "icon icon-list-alt" %> |
              <%= link_to "", cocomo_advanced.add_note_to_factor_path(factor.id), remote: true, class: "icon icon-edit" %>
            </td>
          </tr>
        <% end %>

        <tr>
          <td colspan="4" style="text-align: center">
            <b>
              Attribut personnel
            </b>
          </td>
        </tr>

        <% @apers.compact.each do |factor| %>
          <% selected = InputCocomo.where(factor_id: factor.id, pbs_project_element_id: current_component.id, project_id: current_project.id).first %>
          <% default = OrganizationUowComplexity.where(factor_id: factor.id, is_default: true).first %>
          <tr>
            <td><%= factor.name %></td>
            <td><%= factor.description %></td>
            <td><%= select_tag "factors[#{factor.id}]", options_for_select(factor.organization_uow_complexities.where(organization_id: current_project.organization.id).map{|i| [i.name, i.id]}, selected: selected.nil? ? (default.nil? ? '' : default.id) : (selected.organization_uow_complexity_id)) %></td>
            <td>
              <%= link_to "", cocomo_advanced.help_path(factor.id), class: "", remote: true, class: "icon icon-list-alt" %> |
              <%= link_to "", cocomo_advanced.add_note_to_factor_path(factor.id), remote: true, class: "icon icon-edit" %>
            </td>
          </tr>
        <% end %>

        <tr>
          <td colspan="4" style="text-align: center">
            <b>
              Attribut projet
            </b>
          </td>
        </tr>

        <% @aproj.compact.each do |factor| %>
          <% selected = InputCocomo.where(factor_id: factor.id, pbs_project_element_id: current_component.id, project_id: current_project.id).first %>
          <% default = OrganizationUowComplexity.where(factor_id: factor.id, is_default: true).first %>
          <tr>
            <td><%= factor.name %></td>
            <td><%= factor.description %></td>
            <td><%= select_tag "factors[#{factor.id}]", options_for_select(factor.organization_uow_complexities.where(organization_id: current_project.organization.id).map{|i| [i.name, i.id]}, selected: selected.nil? ? (default.nil? ? '' : default.id) : (selected.organization_uow_complexity_id)) %></td>
            <td>
              <%= link_to "", cocomo_advanced.help_path(factor.id), remote: true, class: "icon icon-list-alt" %> |
              <%= link_to "", cocomo_advanced.add_note_to_factor_path(factor.id), remote: true, class: "icon icon-edit" %>
            </td>
          </tr>
        <% end %>
      </table>

      <%= submit_tag "Save", class: 'btn' %>
    <% end %>

  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel" style="color: white;">
          <%= I18n.t :help %>
        </h4>
      </div>
      <div class="modal-body-inner">
        <div id="content"></div>
      </div>
    </div>
  </div>
</div>