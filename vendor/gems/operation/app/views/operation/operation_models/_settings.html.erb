<h3>
Module d'op√©ration : <%= @operation_model.operation_type.humanize %>
</h3>

<%= form_tag operation.operation_model_save_efforts_path(@operation_model), method: "POST" do %>
  <div class="row-fluid">
    <div class="span12">

      <% effort = PeAttribute.find_by_alias("effort") %>
      <% @elements = Hash.new %>

      <table class="table">
        <tr>
          <th>
            Module
          </th>
          <% ["low", "most_likely", "high", "probable"].each do |level| %>
            <th>
              Effort <%= level %>
            </th>
          <% end %>
        </tr>
        <% current_module_project.previous.each do |mp| %>
          <tr>
            <td><%= mp %></td>
            <% ["low", "most_likely", "high", "probable"].each do |level| %>
              <td>
                <% begin %>
                  <%= val.round(2) %>
                <% rescue %>
                  <%= val[mp.wbs_activity.root_element.id][:value] %>
                <% end %>
              </td>
            <% end %>
          </tr>
        <% end %>
        <tr>
          <td>
            <b>
              Effort total (<%= @operation_model.effort_unit %>)
            </b>
          </td>
          <td>
            <% if @operation_model.operation_type == "addition" %>
              <% res = @elements.values.sum.round(2) %>
            <% elsif @operation_model.operation_type == "moyenne" %>
              <% res = @elements.values.sum / @elements.values.size %>
            <% end %>
            <% ["low", "most_likely", "high"].each do |level| %>
              <%= text_field_tag "effort_#{level}", res.round(2), class: "input-small", readonly: (!@operation_model.enabled_input || cannot?(:alter_estimation_plan, @project))  %>
            <% end %>
          </td>
        </tr>
      </table>

      <% if can? :execute_estimation_plan, @project %>
        <button type="submit" class="btn btn-default btn-mini pull-right"><%= I18n.t(:save) %></button>
      <% end %>
    </div>
  </div>
<% end %>
