<!-- Les valeurs en entrée -->


<!-- Si Trapèze/Linéaire : paramètres du trapèze -->
<% trapeze_parameters = @staffing_custom_data.trapeze_parameter_values %>
<div class="row-fluid">
  <div class="span2"><h4><b>Paramètres du Trapèze (%) : </b></h4></div>
  <%= f.simple_fields_for :trapeze_parameter_values do |ff| %>
      <div class="span1"><%= ff.input :x0, label: "x0", :input_html => { value: trapeze_parameters[:x0], :class => 'input-mini'} %></div>
      <div class="span1"><%= ff.input :y0, label: "y0", :input_html => { value: trapeze_parameters[:y0], :class => 'input-mini'} %></div>
      <div class="span1"><%= ff.input :x1, label: "x1", :input_html => { value: trapeze_parameters[:x1], :class => 'input-mini'} %></div>
      <div class="span1"><%= ff.input :x2, label: "x2", :input_html => { value: trapeze_parameters[:x2], :class => 'input-mini'} %></div>
      <div class="span1"><%= ff.input :x3, label: "x3", :input_html => { value: trapeze_parameters[:x3], :class => 'input-mini'} %></div>
      <div class="span1"><%= ff.input :y3, label: "y3", :input_html => { value: trapeze_parameters[:y3], :class => 'input-mini'} %></div>
  <% end %>
</div>

<div class="row-fluid">
  <div class="span2"><h4><b>Entrées : </b></h4></div>
  <div class="span2"><%= f.input :global_effort_value, label: "Effort", :input_html => { :class => 'input-medium' } %></div>
  <div class="span2"><%= f.input :duration, label: "Durée (semaines)", :input_html => { :class => 'input-medium'} %></div>
</div>


<!-- Affichage du trapèze de Staffing -->
<div id="staffing_trapeze_chart">
  <%#= column_chart(@staffing_custom_data.chart_actual_coordinates, library: {backgroundColor: "transparent", title: "Staffing", vAxis: {title: "Courbe de staffing : Trapèze"}}) %>
  <%= column_chart([ { name: "Staffing théorique", data: @staffing_custom_data.chart_actual_coordinates },
                     { name: "Staffing actuel", data: @staffing_custom_data.chart_actual_coordinates }
                   ],
                   library: { backgroundColor: "transparent", title: "Courbe de Staffing : méthode de Trapèze",
                              vAxis: { title: "Staffing"}, hAxis: { title: I18n.t(:staffing_duration, unit: I18n.t("#{@staffing_custom_data.period_unit}") )} }) %>

  <% theoretical_coordinates = @staffing_custom_data.chart_theoretical_coordinates %>
  <% actual_coordinates = @staffing_custom_data.chart_actual_coordinates %>
  <% staffing_theorique = 0 %>
  <% staffing_actuel = 0 %>

  <table class="table table-striped table-bordered table-condensed">
    <tr>
      <th>Période</th>
      <% for t in 0..@staffing_custom_data.duration %>
          <th><%= "P#{t}" %></th>
      <% end %>
    </tr>

    <tr>
      <td>Théorique</td>
      <% theoretical_coordinates.each do |(coord,value)| %>
          <% rounded_value = value.round(2) %>
          <% staffing_theorique += rounded_value %>
          <td><%= rounded_value %></td>
      <% end %>
    </tr>

    <tr>
      <td>Actuel</td>
      <% actual_coordinates.each do |(coord,value)| %>
          <% rounded_value = value.round(2) %>
          <% staffing_actuel += rounded_value %>
          <td><%= rounded_value %></td>
      <% end %>
    </tr>

  </table>

  <div class="row-fluid">
    <div class="span3">Max staffing = <%= @staffing_custom_data.max_staffing %></div>
    <div class="span3">Staffing théorique : <%= staffing_theorique.round(2) %></div>
    <div class="span3">Staffing actuel : <%= staffing_actuel.round(2) %></div>
  </div>
</div>