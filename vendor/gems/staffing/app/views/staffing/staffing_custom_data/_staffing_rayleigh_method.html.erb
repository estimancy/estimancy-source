<div class="row-fluid">
  <div class="span2"><h4><b>Sélectionner une contrainte : </b></h4></div>
  <div class="span2"><%= f.input :staffing_constraint, as: :select, collection: [['Contrainte de staffing max', 'max_staffing_constraint'], ['Contrainte de durée', 'duration_constraint']], label: 'Contrainte imposée', include_blank: false, :input_html => { :class => 'input-medium'} %></div>
  <div class="span2"><%= f.input :max_staffing, label: "Max staffing", :input_html => { :class => 'input-medium'} %></div>
</div>

<!-- Affichage de la courbe de Staffing avec Rayleigh -->
<h4>
  <b>
    Graphiques
  </b>
</h4>
<div class="row-fluid">
  <div class="span12">
    <div id="staffing_rayleigh_chart">
    </div>
  </div>
</div>

<h4>
  <b>
    Répartition du staffing
  </b>
</h4>
<div class="row-fluid">
  <div class="span12">

    <% theoretical_coordinates = @staffing_custom_data.chart_theoretical_coordinates %>
    <% actual_coordinates = @staffing_custom_data.chart_actual_coordinates %>
    <% staffing_theorique = 0 %>
    <% staffing_actuel = 0 %>

    <table class="table table-striped table-bordered table-condensed">
      <tr>
        <th>Période</th>
        <% for t in 0..@staffing_custom_data.duration %>
          <th><%= "P#{t}" %></th>
        <% end %>
      </tr>

      <tr>
        <td>Théorique</td>
        <% theoretical_coordinates.each do |(coord,value)| %>
          <% rounded_value = value.round(1) %>
          <% staffing_theorique += rounded_value %>
          <td><%= rounded_value %></td>
        <% end %>
      </tr>

      <tr>
        <td>Actuel</td>
        <% actual_coordinates.each do |(coord,value)| %>
          <% rounded_value = value.round(1) %>
          <% staffing_actuel += rounded_value %>
          <td><%= rounded_value %></td>
        <% end %>
      </tr>

    </table>
  </div>
</div>

<div class="row-fluid">
  <div class="span2">Max staffing = <%= @staffing_custom_data.max_staffing.to_i.round(1) %></div>
  <div class="span2">Staffing théorique : <%= staffing_theorique.to_i.round(2) %></div>
  <div class="span2">Staffing actuel : <%= staffing_actuel.to_i.round(2) %></div>
</div>

<script>
  $(function () {
    $('#staffing_rayleigh_chart').highcharts({
      chart: {
        type: 'line'
      },
      title: {
        text: 'Répartition des ressources en fonction du temps'
      },
      subtitle: {
        text: 'Méthode de Rayleigh'
      },
      xAxis: {
        min: 0,
        title: {
          text: 'Evolution du temps'
        }
      },
      yAxis: {
        min: 0,
        title: {
          text: 'Nombre de personne'
        }
      },
      plotOptions: {
        column: {
          pointPadding: 0.2,
          borderWidth: 0
        }
      },
      series: [{
        name: 'Staffing théorique',
        data: <%= @staffing_custom_data.chart_theoretical_coordinates.map{|i| i.last.round(1)} %>

      }, {
        name: 'Staffing actuel',
        data: <%= @staffing_custom_data.chart_actual_coordinates.map{|i| i.last.round(1)} %>

      }]
    });
  });
</script>