$("#guw_type_<%= @guw_unit_of_work.id %>").prop('title', '<%= @new_popup_title %>');

<% unless @guw_type.nil? %>
    $("#guw_type_<%= @guw_unit_of_work.id %>").html("<%= j (select_tag "guw_type[#{@guw_unit_of_work.id}]", options_for_select(@guw_types.map do |i|
                                                            [i.name, i.id]
                                                          end,
                                                      selected: @guw_type.id),
               class: "guw_type",
               style: "width: 90%",
               prompt: "",
               guw: @guw_unit_of_work.id,
               title: @new_popup_title) %>");

<% else %>
    $("#guw_type_<%= @guw_unit_of_work.id %>").html("<%= j(select_tag "guw_type[#{@guw_unit_of_work.id}]", options_for_select(@guw_types.map{|i| [i.name, i.id]}),
               class: "guw_type",
               style: "",
               prompt: "",
               guw: @guw_unit_of_work.id,
               title: '' ) %>");

<% end %>

<% if @guw_unit_of_work.guw_type.display_threshold == true %>
  $(".cotation_label_<%= @guw_unit_of_work.id %>").html("<%= j(select_tag "guw_complexity_#{@guw_unit_of_work.id}", options_for_select(@guw_unit_of_work.guw_type.guw_complexities.map{|i| [i.name, i.id] }, selected: nil), class: "input-small", style: "width: 70px;", prompt: "", disabled: !@guw_unit_of_work.guw_type.allow_complexity) %>")
<% else %>
  $(".cotation_label_<%= @guw_unit_of_work.id %>").html("-");
<% end %>

<% if @guw_unit_of_work.guw_type.allow_criteria == true %>
  <% counting = @guw_unit_of_work.guw_unit_of_work_attributes.where(guw_type_id: @guw_unit_of_work.guw_type_id).map(&:most_likely).compact %>
  <% if counting.empty? %>
    $(".criteria_label_<%= @guw_unit_of_work.id %>").html("<%= j(link_to("", guw.guw_unit_of_work_load_cotations_path(@guw_unit_of_work), method: "post", remote: true, class: "fa fa-gears", style: "color: black;")) %>")
  <% else %>
    $(".criteria_label_<%= @guw_unit_of_work.id %>").html("<%= j(link_to("", guw.guw_unit_of_work_load_cotations_path(@guw_unit_of_work), method: "post", remote: true, class: "fa fa-gears", style: "color: #0088cc;")) %>")
  <% end %>
<% else %>
  $(".criteria_label_<%= @guw_unit_of_work.id %>").html("")
<% end %>

<% @guw_model.guw_coefficients.where(organization_id: @guw_model.organization_id).each do |guw_coefficient| %>
  <% if guw_coefficient.coefficient_type == "Pourcentage" || guw_coefficient.coefficient_type == "Coefficient" %>
    <% unless @guw_type.nil? %>
      <% results = guw_coefficient.guw_coefficient_elements.map{|i| i.guw_complexity_coefficient_elements.includes(:guw_coefficient_element).where(organization_id: @guw_model.organization_id, guw_model_id: @guw_model.id, guw_type_id: @guw_unit_of_work.guw_type.id).select{|ct| ct.value != nil }.map{|i| i.guw_coefficient_element }.uniq }.flatten.compact.sort! { |a, b|  a.display_order.to_i <=> b.display_order.to_i } %>
    <% else %>
      <% results = [] %>
    <% end %>
    $("#guw_coefficient_percent_<%= @guw_unit_of_work.id %>_<%= guw_coefficient.id %>").val(<%= results.first.nil? ? '' : results.first.default_display_value %>);
  <% end %>
<% end %>

