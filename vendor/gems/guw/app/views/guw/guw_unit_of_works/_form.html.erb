<b>
  <%= I18n.t :new_unit_of_work %>
</b>

<div class="tabs">
  <ul>
    <li>
      <a href="#tabs-1">
        <%= I18n.t :new_unit_of_work %>
      </a>
    </li>
  </ul>

  <div id="tabs-1">
    <%= simple_form_for(@guw_unit_of_work) do |f| %>
      <%= f.error_notification %>

      <%= f.input :guw_model_id, as: :hidden, input_html: { value: params[:guw_model_id] } %>

      <div class="row-fluid">
        <div class="span5">
          <div class="form-inputs">

            <%= f.input :organization_id, :as => :hidden, :input_html => { :value => @organization.id || params[:organization_id]} %>
            <%= f.input :project_id, :as => :hidden, :input_html => { :value => @project.id || params[:project_id]} %>

            <%= hidden_field_tag :position, params[:position] %>

            <%= f.input :name, label: I18n.t(:uw_name), input_html: { class: "input-xxlarge" } %>
            <%= f.input :comments, input_html: { rows: "5", class: "input-xxlarge" }, label: I18n.t(:description) %>
            <%= f.input :guw_type_id,
                        as: :select,
                        collection: @guw_model.guw_types.map{|i| [i.name, i.id]}.to_a.sort,
                        label: I18n.t(:work_unit_type),
                        include_blank: false,
                        input_html: { class: "input-xxlarge" } %>

            <% if @guw_model.config_type == "old" %>
              <% unless @guw_model.coefficient_label.blank? %>
                <% work_units = @guw_model.guw_work_units.map{|i| i.guw_complexity_work_units.select{|ct| ct.value != nil }.map{|i| i.guw_work_unit }.uniq }.flatten.compact.sort! { |a, b|  a.display_order.to_i <=> b.display_order.to_i } %>
                <%= f.input :guw_work_unit_id, as: :select, collection: work_units, label: @guw_model.coefficient_label.to_s, include_blank: false, input_html: { class: "input-xxlarge" } %>
              <% end %>

              <% unless @guw_model.weightings_label.blank? %>
                <% weightings = @guw_model.guw_weightings.map{|i| i.guw_complexity_weightings.select{|ct| ct.value != nil }.map{|i| i.guw_weighting }.uniq }.flatten.compact.sort! { |a, b|  a.display_order.to_i <=> b.display_order.to_i } %>
                <%= f.input :guw_weighting_id, as: :select, collection: weightings, label: @guw_model.weightings_label.to_s, include_blank: false, input_html: { class: "input-xxlarge" } %>
              <% end %>

              <% unless @guw_model.factors_label.blank? %>
                <% factors = @guw_model.guw_factors.map{|i| i.guw_complexity_factors.select{|ct| ct.value != nil }.map{|i| i.guw_factor }.uniq }.flatten.compact.sort! { |a, b|  a.display_order.to_i <=> b.display_order.to_i } %>
                <%= f.input :guw_factor_id, as: :select, collection: factors, label: @guw_model.factors_label.to_s, include_blank: false, input_html: { class: "input-xxlarge" } %>
              <% end %>

              <% default_technology = Guw::GuwUnitOfWorkGroup.find(params[:g]).organization_technology %>
              <% if @guw_model.allow_technology == true %>
                <%= f.input :organization_technology_id,
                            as: :select,
                            collection: @guw_model.guw_types.first.guw_complexity_technologies.select{|ct| ct.coefficient != nil }.map{|i| i.organization_technology }.uniq.map{|i| [i.name, i.id]},
                            selected: default_technology.nil? ? nil : default_technology.id,
                            label: I18n.t(:organization_technology),
                            include_blank: false,
                            input_html: { class: "input-xxlarge" } %>
              <% end %>
            <% end %>

            <%= f.input :guw_unit_of_work_group_id, as: :select, collection: current_module_project.guw_unit_of_work_groups, label: I18n.t(:uw_groups), selected: params[:g], input_html: { class: "input-xxlarge" }  %>
          </div>
        </div>
        <div class="span7">
          <span class="guw_type_description">
            <%= simple_format(@guw_model.guw_types.first.description) %>
          </span>
        </div>
      </div>

      <%= f.button :submit, I18n.t('save'), class: "btn btn-primary" %>
      <%= link_to I18n.t(:back), main_app.dashboard_path(@project), class: "btn" %>
  <% end %>
  </div>
</div>


<script>
  $('#guw_unit_of_work_guw_type_id').change(function(){
    $.ajax({
      url: "<%= guw.change_technology_form_path %>",
      data: "guw_type_id=" + this.value
    });
  });
</script>