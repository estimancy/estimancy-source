<div class="modal-header modal-drag">
  <h4 class="modal-title"> Coefficients déportés </h4>
</div>

<div class="modal-body" style="height: inherit;">
  <table class="table table-condensed table-striped">
    <tr>
      <th>Nom du coefficient</th>
      <th>Valeurs</th>
    </tr>

    <% @guw_model.guw_coefficients.where(deported: true).each do |guw_coefficient| %>

      <tr>
        <td>
          <%= guw_coefficient.name %>
        </td>
        <td>

          <% ceuw = Guw::GuwCoefficientElementUnitOfWork.where(guw_unit_of_work_id: @guw_unit_of_work.id,
                                                               guw_coefficient_id: guw_coefficient.id).first %>

          <% results = guw_coefficient.guw_coefficient_elements.map{|i| i.guw_complexity_coefficient_elements.includes(:guw_coefficient_element).where(guw_type_id: @guw_type.id).select{|ct| ct.value != nil }.map{|i| i.guw_coefficient_element }.uniq }.flatten.compact.sort! { |a, b|  a.display_order.to_i <=> b.display_order.to_i } %>
          <%= select_tag "guw_coefficient[#{@guw_unit_of_work.id}][#{guw_coefficient.id}]",
                         options_for_select(results.map{|i| [i.name, i.id]},
                                            selected: ceuw.nil? ? (results.first.nil? ? nil : results.first.value) : ceuw.guw_coefficient_element_id),
                         class: "guw_coefficient guw-#{@guw_unit_of_work.id}",
                         guw: @guw_unit_of_work.id,
                         readonly: !can?(:execute_estimation_plan, @project),
                         style: "width: 70px;" %>
        </td>
      </tr>

    <% end %>
  </table>
</div>

<div class="modal-footer">
  <button type="button" class="btn btn-default" data-dismiss="modal" >
    <%= I18n.t(:close_without_calculate) %>
  </button>
  <% if can? :execute_estimation_plan, @project %>
    <button type="submit" class="btn btn-default"> <%= I18n.t(:calculate) %></button>
  <% end %>
</div>