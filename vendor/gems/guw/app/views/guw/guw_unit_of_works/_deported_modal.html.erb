<div class="modal-header modal-drag">
  <h4 class="modal-title"> Coefficients déportés </h4>
</div>

<div class="modal-body" style="height: inherit;">
  <table class="table table-condensed table-striped">
    <tr>
      <th>
        <span class="pull-left">
          Nom du coefficient
        </span>
      </th>
      <th>
        <span class="pull-left">
          Valeurs
        </span>
      </th>
    </tr>

    <% @guw_model.guw_coefficients.where(deported: true).each do |guw_coefficient| %>

      <tr>

        <td>
          <span class="pull-left">
            <%= link_to guw_coefficient.name, "#", title: guw_coefficient.description, class: "attribute_tooltip pull-left"  %>
          </span>
        </td>

        <td>
          <span class="pull-left">
            <% ceuw = Guw::GuwCoefficientElementUnitOfWork.where(guw_unit_of_work_id: @guw_unit_of_work.id,
                                                                 guw_coefficient_id: guw_coefficient.id).first %>

            <% results = guw_coefficient.guw_coefficient_elements.map{|i| i.guw_complexity_coefficient_elements.includes(:guw_coefficient_element).where(guw_type_id: @guw_type.id).select{|ct| ct.value != nil }.map{|i| i.guw_coefficient_element }.uniq }.flatten.compact.sort! { |a, b|  a.display_order.to_i <=> b.display_order.to_i } %>
            <% default = guw_coefficient.guw_coefficient_elements.where(default: true).first %>

            <%= select_tag "guw_coefficient[#{@guw_unit_of_work.id}][#{guw_coefficient.id}]",
                           options_for_select(results.map{|i| [i.name, i.id]},
                                              selected: ceuw.nil? ? (default.nil? ? results.first.id : default.id) : (ceuw.guw_coefficient_element_id.nil? ? default.value : ceuw.guw_coefficient_element_id)),
                           class: "guw_coefficient guw-#{@guw_unit_of_work.id}",
                           guw: @guw_unit_of_work.id,
                           readonly: !can?(:execute_estimation_plan, @project),
                           style: "width: 180px;" %>
          </span>
        </td>

      </tr>

    <% end %>
  </table>
</div>

<div class="modal-footer">
  <button type="button" class="btn btn-default" data-dismiss="modal" >
    <%= I18n.t(:close_without_calculate) %>
  </button>
  <% if can? :execute_estimation_plan, @project %>
    <button type="submit" class="btn btn-default"> <%= I18n.t(:calculate) %></button>
  <% end %>
</div>