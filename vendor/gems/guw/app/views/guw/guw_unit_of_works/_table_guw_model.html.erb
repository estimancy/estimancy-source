<% current_module_project.guw_unit_of_work_groups.each do |uowg| %>
  <div class="accordion" id="accordion2">
    <div class="accordion-group">
      <div class="accordion-heading">
        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion_<%= uowg.id %>" href="#collapse<%= uowg.id %>">
          <%= uowg %>
        </a>
      </div>
      <div id="collapse<%= uowg.id %>" class="accordion-body collapse in">
        <div class="accordion-inner">
          <table class="table table-bordered table-condensed">
            <tr>
              <th>Name</th>
              <th>UoType</th>
              <th>Attributs</th>
              <th>Cplx. UO</th>
              <th>Valeur</th>
              <th>Valeur retenu</th>
              <th>Actions</th>
            </tr>

            <% uowg.guw_unit_of_works.each_with_index do |guow, i| %>
              <tr>
                <td style="vertical-align: middle">
                  <a href=<%= guw.edit_guw_model_guw_unit_of_work_path(@guw_model, guow) %>>
            <span title="<%= guow.comments %>" class="attribute_tooltip">
              <%= guow.name %>
            </span>
                  </a>
                </td>
                <td style="vertical-align: middle">
                  <%= select_tag "guw_type[#{guow.id}]", options_for_select(@guw_model.guw_types.map{|i| [i.name, i.id]}, selected: guow.guw_type_id ) %>
                </td>
                <td>
                  <table class="table table-bordered table-condensed">
                    <% guow.guw_unit_of_work_attributes.each_with_index do |uowa, j| %>
                      <% unless uowa.guw_attribute.guw_attribute_complexities.map{|i| [i.bottom_range, i.top_range]}.flatten.compact.first.nil? %>
                        <tr>
                          <td>
                            <%= uowa.guw_attribute.name %>
                          </td>
                          <td>
                            <%= text_field_tag "low[#{guow.id}][#{uowa.id}]", uowa.low, class: "input-mini" %>
                          </td>
                          <td>
                            <%= text_field_tag "most_likely[#{guow.id}][#{uowa.id}]", uowa.most_likely, class: "input-mini" %>
                          </td>
                          <td>
                            <%= text_field_tag "high[#{guow.id}][#{uowa.id}]", uowa.high, class: "input-mini" %>
                          </td>
                        </tr>
                      <% end %>
                    <% end %>
                  </table>
                </td>
                <td style="vertical-align: middle">
                  <% if guow.guw_complexity.nil? %>
                    <%= text_field_tag "cplx[#{guow.id}]", '', class: "input-mini", disabled: true %>
                  <% else %>
                    <%= text_field_tag "cplx[#{guow.id}]", guow.guw_complexity.name , class: "input-mini", disabled: true %>
                  <% end %>
                </td>
                <td style="vertical-align: middle">
                  <%= guow.effort %>
                </td>
                <td style="vertical-align: middle">
                  <%= text_field_tag "ajusted_effort[#{guow.id}]", guow.ajusted_effort, class: "input-mini" %>
                </td>
                <td style="vertical-align: middle">
                  <%= link_to "Supprimer", guw.guw_unit_of_work_path(guow), method: "delete", class: "btn btn-mini" %>
                </td>
              </tr>
            <% end %>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
<% end %>

<%= link_to "Ajouter un UO", guw.new_guw_model_guw_unit_of_work_path(@guw_model), class: "btn btn-mini" %>
<%= link_to "Ajouter groupe d'UO", guw.new_guw_unit_of_work_group_path, class: "btn btn-mini" %>
<%= submit_tag "Sauvegarder", class: "btn btn-mini" %>