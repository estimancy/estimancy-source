<%= form_tag guw.guw_unit_of_works_save_guw_unit_of_works_path do %>
  <div id="table_guw_model">
    <% Guw::GuwUnitOfWorkGroup.where(pbs_project_element_id: current_component.id, module_project_id: current_module_project.id).all.each do |uowg| %>

      <h4>
        <%= link_to uowg, guw.edit_guw_unit_of_work_group_path(uowg), title: I18n.t(:edit) %>
        - <%= link_to '', guw.guw_unit_of_work_group_path(uowg), method: "delete", confirm: I18n.t('are_you_sure'), :class => 'fa fa-trash-o', :title => I18n.t('delete') %>
      </h4>

      <%= link_to I18n.t('add_new_unit_of_work_group'), guw.new_guw_unit_of_work_group_path, class: "btn btn-mini pull-right" %>
      <%= link_to "Créer une Unité d'Oeuvres", guw.new_guw_model_guw_unit_of_work_path(@guw_model), class: "btn btn-mini pull-right" %>
      <%= link_to I18n.t('add_new_unit_of_work_group'), guw.new_guw_unit_of_work_group_path, class: "btn btn-mini pull-right" %>

      <br>


      <table class="table table-condensed table-striped" style="margin-bottom: 0px;">
        <tr>
          <th>Nom</th>
          <th>Description</th>
          <th>Cotation</th>
          <th>Résultat</th>
          <th>Retenu</th>
          <th>Type d'acquisition</th>
          <th>Actions</th>
        </tr>

        <% uowg.guw_unit_of_works.each_with_index do |guow, i| %>
          <tr>
            <td>
              <%= guow.name %>
            </td>

            <td>
              <%= guow.comments %>
            </td>

            <td>
              <% if guow.guw_complexity.nil? %>
                '-'
              <% else %>
                <%= guow.guw_complexity.name %>
              <% end %>
            </td>

            <td>
              <%= link_to guow.effort.nil? ? '-' : guow.effort, "#", :"data-toggle" => "modal", :"data-target" => "#modal#{guow.id}" %>
            </td>

            <td>
              <%= text_field_tag "ajusted_effort[#{guow.id}]", guow.ajusted_effort, class: "input-mini" %>
            </td>

            <td>
              <%= select_tag "work_unit[#{guow.id}]", options_for_select(@guw_model.guw_work_units.map{|i| [i.name, i.id]}, selected: guow.guw_work_unit_id), prompt: "Select a work unit", required: true %>
            </td>

            <td>
              <%= link_to "", guw.guw_unit_of_work_path(guow), method: "delete", class: "fa fa-trash" %>
            </td>

            <td>
              <div class="modal fade" id="modal<%= guow.id %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel<%= guow.id %>" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h4 class="modal-title" id="ModalLabel<%= guow.id %>">Attributs de <%= guow %> </h4>
                    </div>
                    <div class="modal-body">
                      <table class="table table-condensed table-striped">
                        <% guow.guw_unit_of_work_attributes.each_with_index do |uowa, j| %>
                          <tr>
                            <% unless guow.guw_type.nil? %>
                              <% sum_range = uowa.guw_attribute.guw_attribute_complexities.where(guw_type_id: guow.guw_type.id).map{|i| [i.bottom_range, i.top_range]}.flatten.compact %>
                            <% end %>
                            <% unless sum_range.nil? || sum_range.blank? || sum_range == 0 %>
                              <td>
                                <%= link_to uowa.guw_attribute.name, "#", title: uowa.guw_attribute.description, class: "attribute_tooltip pull-left" %>
                              </td>
                              <td>
                                <%= text_field_tag "low[#{guow.id}][#{uowa.id}]", uowa.low, class: "input-mini" %>
                              </td>
                              <td>
                                <%= text_field_tag "most_likely[#{guow.id}][#{uowa.id}]", uowa.most_likely, class: "input-mini" %>
                              </td>
                              <td>
                                <%= text_field_tag "high[#{guow.id}][#{uowa.id}]", uowa.high, class: "input-mini" %>
                              </td>
                            <% end %>
                          </tr>
                        <% end %>
                      </table>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Fermer sans calculer</button>
                      <button type="submit" class="btn btn-default">Calculer</button>
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        <% end %>
      </table>

      <button type="submit" class="btn btn-default btn-mini pull-right">Sauvegarder</button>

      </div>
  <% end %>

<% end %>