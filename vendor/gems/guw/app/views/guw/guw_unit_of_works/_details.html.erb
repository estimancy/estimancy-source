<% unless @guw_model.guw_types.empty? %>
  <h5>
    Nombre d'unité d'oeuvre par type
  </h5>
  <table class="table">
    <tr>
      <th>Type</th>
      <th>Nombre d'UO</th>
      <% @guw_model.guw_outputs.each do |guw_output| %>
        <th>
          <%= guw_output.name %>
        </th>
      <% end %>
    </tr>
    <% @guw_model.guw_types.uniq.each do |guw_type| %>
      <tr>
        <td>
          <%= guw_type.name %>
        </td>
        <td>
          <%= guw_type.guw_unit_of_works.where(module_project_id: current_module_project.id).count.to_i %>
        </td>
        <% @guw_model.guw_outputs.each do |guw_output| %>
          <td>
            <%= guw_type.guw_unit_of_works.where(module_project_id: current_module_project.id).map{|i| i.ajusted_size.nil? ? 0 : i.ajusted_size["#{guw_output.id}"].to_f }.compact.sum.to_f %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </table>
<% end %>

<% @guw_model.guw_coefficients.each do |coefficient| %>
  <h5>
    Nombre d'unité d'oeuvre par <%= coefficient.name %>
  </h5>
  <table class="table">

    <tr>
      <th><%= coefficient.name %></th>
      <th>Nombre d'UO</th>
      <% @guw_model.guw_outputs.each do |guw_output| %>
        <th>
          <%= guw_output.name %>
        </th>
      <% end %>    </tr>

    <% coefficient.guw_coefficient_elements.each do |guw_coefficient_element| %>
      <tr>
        <td>
          <%= guw_coefficient_element.name %>
        </td>
        <td>
          <%= Guw::GuwCoefficientElementUnitOfWork.where(guw_coefficient_element_id: guw_coefficient_element.id,
                                                         guw_coefficient_id: coefficient.id,
                                                         module_project_id: current_module_project.id).size %>
        </td>
        <% @guw_model.guw_outputs.each do |guw_output| %>
          <td>
            <%= Guw::GuwCoefficientElementUnitOfWork.where(guw_coefficient_element_id: guw_coefficient_element.id,
                                                           guw_coefficient_id: coefficient.id,
                                                           module_project_id: current_module_project.id).allmap do |i|
              i.guw_unit_of_work.nil? ? nil : i.guw_unit_of_work.ajusted_size["#{guw_output.id}"].to_f
            end.compact.sum.to_f %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </table>
<% end %>