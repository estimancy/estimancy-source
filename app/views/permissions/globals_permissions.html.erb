<div class="tabs">

  <ul>
    <li><a href="#tabs-1"><%= I18n.t(:global_permission) %></a></li>
    <li><a href="#tabs-2"><%= I18n.t(:project_permissions) %></a></li>
    <% if is_master_instance? %>
      <li><a href="#tabs-3"><%= I18n.t(:master) %></a></li>
    <% end %>
  </ul>

  <div id="tabs-1">
    <%= form_tag({:action=> 'set_rights', :controller=> 'permissions'}, :method => 'post', :class => 'simple_form') do %>
      <table class="table table-striped table-bordered table-condensed">

          <tr>
            <th style="text-align:left;"><%= I18n.t(:permissions) %></th>
            <% @groups.each do |group| %>
              <th style="text-align:center;">
                <%= group.name %>
              </th>
            <% end %>
          </tr>


        <tbody>
          <% @permissions_classes_globals.each do |cla| %>
            <tr>
              <td colspan=<%= @groups.size+1 %> >
                <h5><%= cla.blank? ? 'General' : cla.humanize %></h5>
              </td>
            </tr>
            <% for perm in @global_permissions %>
              <tr>
                <% if perm.category.to_s == cla %>
                  <td>
                    <%= link_to (perm.alias.blank? ? perm.description : perm.alias), edit_permission_path(perm), :class => "attribute_tooltip unstyled", :title => perm.description %>
                  </td>
                  <% @groups.each do |group| %>
                    <%= hidden_field_tag "permissions[#{group.id}][]" %>
                    <td style="text-align: center;">
                      <%= check_box_tag("permissions[#{group.id}][]", perm.id, (group.permissions.map(&:id).include? perm.id), :id => nil, :class => "group_#{group.id}")%>
                    </td>
                  <% end %>
                <% end %>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
      <%= submit_tag I18n.t('apply'), :class => 'btn' %>
    <% end %>
  </div>

  <div id="tabs-2">
    <%= form_tag({:action=> 'set_rights_project_security', :controller=> 'permissions'}, :method => 'post', :class => 'simple_form') do %>
      <table class="table table-striped table-bordered table-condensed">

        <tr>
          <th style="text-align:left;"></th>
          <% @project_security_levels.each do |ps| %>
            <th style="text-align:center;">
              <%= ps.name %>
            </th>
          <% end %>
        </tr>

        <tbody>
          <% @permissions_classes_projects.each do |cla| %>
            <tr>
              <td colspan=<%= @project_security_levels.size+1 %>>
                <h5><%= cla.blank? ? 'General' : cla %></h5>
              </td>
            </tr>
            <% for perm in @permission_projects %>
              <tr>
                <td><%= link_to perm.description, edit_permission_path(perm), :class => "attribute_tooltip", :title => perm.description  %></td>
                <% @project_security_levels.each do |ps| %>
                  <td style="text-align: center;">
                    <%= check_box_tag("permissions[#{ps.id}][]", perm.id, (ps.permissions.map(&:id).include? perm.id), :id => nil, :class => "group_#{ps.id}")%>
                  </td>
                <% end %>
              </tr>
            <% end %>
          <% end %>
        </tbody>

      </table>
      <%= submit_tag I18n.t('apply'), :class => 'btn' %>
    <% end %>
  </div>


  <% if is_master_instance? %>
    <div id="tabs-3">
      <%= form_tag({:action=> 'set_rights_project_security', :controller=> 'permissions'}, :method => 'post', :class => 'simple_form') do %>
        <table class="table table-striped table-bordered table-condensed">

          <tr>
            <th style="text-align:left;"></th>
            <% @groups.each do |ps| %>
              <th style="text-align:center;">
                <%= ps.name %>
              </th>
            <% end %>
          </tr>

          <tbody>
          <% @permissions_classes_masters.each do |cla| %>
            <tr>
              <td colspan=<%= @groups.size+1 %>>
                <h5><%= cla.blank? ? 'General' : cla %></h5>
              </td>
            </tr>
            <% for perm in @master_permissions %>
              <tr>
                <td><%= link_to perm.description, edit_permission_path(perm), :class => "attribute_tooltip", :title => perm.description  %></td>
                <% @groups.each do |ps| %>
                  <td style="text-align: center;">
                    <%= check_box_tag("permissions[#{ps.id}][]", perm.id, (ps.permissions.map(&:id).include? perm.id), :id => nil, :class => "group_#{ps.id}")%>
                  </td>
                <% end %>
              </tr>
            <% end %>
          <% end %>
          </tbody>

        </table>
        <%= submit_tag I18n.t('apply'), :class => 'btn' %>
      <% end %>
    </div>
  <% end %>

</div>

