$("#notifications").html("<%= j(render "layouts/notifications") %>");
$("#activities_ratio_per_profile").html("<%= j(render(:partial => 'wbs_activities/activities_ratio_per_profile', :object => [@wbs_activity_ratio_elements, @wbs_organization_profiles])) %>");

//Update the total ratio value per activity when activity's profile ratio has changed
$('.profiles_per_activity').change(function(){
    var ap_id = $(this).attr('id');
    var ap_value = $('#'+ap_id).val();
    ap_value = parseFloat(ap_value.replace("," , "."));

    if(!isNaN(parseFloat(ap_value)) && isFinite(ap_value)){
        var activity_id = $(this).data('activity_id');
        var sum_of_ratio = 0;
        $("tr").find("[data-activity_id='" + activity_id + "']").each(function(){
            var current_ratio_value = $(this).val();
            if((current_ratio_value != "") && (current_ratio_value != undefined))
                sum_of_ratio += parseFloat(current_ratio_value.replace("," , "."));
        });
        $('td#total_ratio_activity_'+activity_id).text(sum_of_ratio + ' %');
        if(sum_of_ratio > 100){
            $('td#total_ratio_activity_'+activity_id).css('color', 'red');
            alert("Warning : sum of activity's ratio values is greater than 100 !");
        }
        else { $('td#total_ratio_activity_'+activity_id).css('color', '#444'); }
    }
    return false;
});