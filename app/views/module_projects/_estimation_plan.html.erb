
<% module_projects = @project.module_projects %>
<% @alphabet = %w(A B C D E F G H I J K L M N O P Q R S T U V W X Y Z) %>

<% unless module_projects.empty? %>
  <table class="table table-condensed table-bordered table-estimation" >
    <theader>
    <tr>
      <th>
        <%= link_to "", locked_plan_path(@project.id), :class => "#{ @project.locked? ? 'icon-lock' : 'icon-unlock' } icon-large", :title => "#{ @project.locked? ? 'Unlock estimation plan' : 'Lock estimation plan' }" %>
      </th>
      <% for x in 1..@module_positions_x.to_i do %>
          <th><h4><%= @alphabet[x-1] %></h4></th>
      <% end %>
    </tr>
    </theader>
    <!-- The INITIALIZATION module -->
    <%= render :partial => 'module_projects/initialization_module' %>

    <!-- Others modules -->
      <% for y in 1..@module_positions do %>
        <tr>
          <td class="line_number">
              <h4 class="text-center"><%= y %></h4>
          </td>

          <% for x in 1..@module_positions_x.to_i do %>
            <td class="module_bloc_size" >
              <% pmod = @project.module_projects.where("position_x = ? AND position_y = ?", x, y).first %>

              <% unless pmod.nil? %>
                <% if @pbs_project_element %>
                  <% if pmod.pbs_project_elements.map(&:id).include?(@pbs_project_element.id) %>
                    <% pbs_class = 'highlight' %>
                  <% else %>
                      <% pbs_class= "" %>
                  <% end %>
                <% end %>

                <div class="<%= pbs_class %> module_project <%= "#{pmod.pemodule.alias}_#{pmod.position_x}_#{pmod.position_y}" %> text-center">
                    <%= link_to pmod.pemodule.title, "#", class: "a_white" %>
                    <br>
                    <% unless @project.locked? || (@project.in_frozen_status? && action_name=="show") %>
                      <%= link_to '', pemodules_left_path(pmod.id), :class => 'icon-arrow-left a_white' %>
                      <%= link_to '', pemodules_up_path(pmod.id), :class => 'icon-arrow-up a_white' %>
                      <%= link_to '', pemodules_down_path(pmod.id), :class => 'icon-arrow-down a_white' %>
                      <%= link_to '', pemodules_right_path(pmod.id), :class => 'icon-arrow-right a_white' %>
                      <%= link_to '', '#', :title => "#{pmod.pemodule.title}: \n #{pmod.pemodule.description}", :class => "icon-info attribute_tooltip a_white" %>
                      <%= link_to '', edit_module_project_path(pmod.id), :class => "icon-edit a_white" %>
                      <%= link_to '', pmod, confirm: I18n.t('are_you_sure'), method: :delete, :class => 'icon-trash a_white' %>
                    <% end %>
                </div>

                <%= render :partial => 'module_projects/estimation_paths', :locals => { :pmod => pmod } %>

              <% end %>
            </td>
          <% end %>
        </tr>
      <% end %>
  </table>
<% else %>
  <%= content_tag(:div, I18n.t(:notice_no_estimation_plan_defined), :class => 'alert alert-info') %>
<% end %>
