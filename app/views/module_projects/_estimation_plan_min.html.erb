<% module_projects = @project.module_projects %>
<% @alphabet = %w(A B C D E F G H I J K L M N O P Q R S T U V W X Y Z) %>

<% unless module_projects.empty? %>
  <table class="table table-estimation">

      <!-- The Initialization module -->
      <%= render :partial => 'module_projects/initialization_module_min' %>

      <% for y in 1..@module_positions do %>
        <tr>
          <% for x in 1..@module_positions_x.to_i do %>
            <td>
              <% pmod = @project.module_projects.where("position_x = ? AND position_y = ?", x, y).first %>

              <% unless current_module_project.nil? or pmod.nil? %>
                <% (current_module_project.id == pmod.id) ? select_pemodule = 'selected_module_project' : 'unselected_module_project' %>
              <% end %>

                <% unless pmod.nil? %>
                  <div class="<%= select_pemodule %> module_project_min <%= "#{pmod.pemodule.alias}_#{pmod.position_x}_#{pmod.position_y}" %> text-center">
                    <% if pmod.pemodule.alias == "guw" %>
                      <%= link_to pmod.guw_model.nil? ? 'Undefined model': pmod.guw_model , activate_module_project_path(pmod), :remote => true %>
                  <% else %>
                    <%= link_to pmod.pemodule.title, activate_module_project_path(pmod), :remote => true %>
                    <%= link_to ' ', '#', :title => "#{pmod.pemodule.title}: \n #{pmod.pemodule.description}", :class => "icon-info attribute_tooltip" %>
                  <% end %>
                </div>
                <%= render :partial => 'module_projects/estimation_paths', :locals => { :pmod => pmod } %>
              <% end %>

              <% select_pemodule = '' %>

            </td>
          <% end %>
        </tr>
      <% end %>
  </table>
<% else %>
  <%= content_tag(:div, I18n.t(:notice_no_estimation_plan_defined), :class => 'alert alert-info') %>
<% end %>

