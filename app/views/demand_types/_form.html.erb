<div class="tabs">
  <ul>
    <li>
      <a href="#tabs-1">
        Type de demande
      </a>
    </li>
  </ul>
  <div id="tabs-1">
    <%= simple_form_for([@organization, @demand_type]) do |f| %>
      <%= f.error_notification %>

      <%= f.input :name, :label => I18n.t('name'), :input_html => {:class => 'input-xxlarge', :autofocus => (controller.action_name == 'new')} %>
      <%= f.input :description, :as => :text, :label => I18n.t('description'), :input_html => {:class => 'input-xxlarge'} %>

      <%= f.input :cost_from, as: :select, collection: ["Devis", "Saisie", "Cout associé à l'application"], :label => "Provenance coût à facturer", :input_html => {:class => 'input-xlarge'} %>
      <%= f.input :demand_status_id, as: :select, collection: @organization.demand_statuses.map{|i| [i.name, i.id]} , :label => "Statut de départ", :input_html => {:class => 'input-xlarge'} %>

      <%= f.input :fixed_billing, :label => "Facturation fixe", :input_html => {:class => 'input-xxlarge'} %>
      <%= f.input :deadlined_billing, :label => "Facturation sur échéance", :input_html => {:class => 'input-xxlarge'} %>

      <%= f.input :billing, as: :select, collection: ["Echéance", "Abonnement", "Sans facturation"], :label => "Billing" , :input_html => {:class => 'input-xlarge'} %>

      <%= f.input :organization_id, as: :hidden, input_html: { :value => @organization.id } %>

      <br>

      <div class="row-fluid">
        <div class="span4">
          <%= f.collection_check_boxes(:service_ids, Service.where(organization_id: @organization.id).all, :id, :to_s) do |b| %>
            <div class="row-fluid">
              <%= b.label(class: "check_box") do %>
                <div class="span1">
                  <%= b.check_box(class: "check_box") %>
                </div>
                <div class="span11">
                  <%= b.object.name %>
                </div>
              <% end %>
            </div>
          <% end %>

        </div>
        <div class="span4">
          <table class="table">
            <% @organization.demand_statuses.each do |ds| %>
              <tr>
                <td>
                  <%= ds.name %>
                </td>
                <td>
                  <%
                    dsdt = DemandStatusesDemandType.where(organization_id: @organization.id,
                                                          demand_type_id: @demand_type.id,
                                                          demand_status_id: ds.id).first
                  %>
                  <%= text_field_tag "percent_#{ds.id}", dsdt.nil? ? nil : dsdt.percent %>
                </td>
              </tr>
            <% end %>
          </table>
        </div>

        <div class="span4">
          <table class="table">
            <tr>
              <th></th>
              <th>Sévérité S1</th>
              <th>Sévérité S2</th>
              <th>Sévérité S3</th>
            </tr>
            <tr>
              <td>Criticité C1</td>
              <td><%= check_box_tag "" %></td>
              <td><%= check_box_tag "" %></td>
              <td><%= check_box_tag "" %></td>
            </tr>
            <tr>
              <td>Criticité C2</td>
              <td><%= check_box_tag "" %></td>
              <td><%= check_box_tag "" %></td>
              <td><%= check_box_tag "" %></td>
            </tr>
            <tr>
              <td>Criticité C3</td>
              <td><%= check_box_tag "" %></td>
              <td><%= check_box_tag "" %></td>
              <td><%= check_box_tag "" %></td>
            </tr>
          </table>
        </div>
      </div>



      <div class="actions-tabs">
        <% if action_name == 'new' || action_name=="create" %>
            <%= submit_tag I18n.t('save_and_create'), :class => 'btn btn-primary' %>
            <%= submit_tag I18n.t('save'), :class => 'btn btn-primary' %>
        <% elsif action_name == 'edit' || action_name=="update" %>
            <%= submit_tag I18n.t('save'), :class => 'btn btn-primary' %>
            <%= submit_tag I18n.t('apply'), :class => 'btn btn-primary' %>
        <% end %>
        <%= link_to I18n.t('back'), organization_setting_demand_path(@organization), :class => 'btn' %>
      </div>
    <% end %>
  </div>
</div>