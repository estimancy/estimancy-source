<%= form_tag "set_abacus", :method => 'POST', :class => 'simple_form' do %>
  <table>
    <tr>
      <td>
        <b><%= I18n.t(:text_organization_abacus) %></b>
      </td>
      <td>&nbsp;&nbsp; </td>
      <td>
        <%= select_tag "technology", options_for_select(@organization.organization_technologies.map { |i| [i.name, i.id] }, :selected => @ot.nil? ? '' : @ot.id) %>
      </td>
    </tr>
  </table>

  <br/>

  <table class="table table-striped table-bordered table-condensed permissions">
    <tr>
      <th style="text-align:left;"><%= I18n.t(:organization_abacus) %></th>
      <% @complexities.each do |ouc| %>
        <th class="text-center">
          <%= ouc.name %>
        </th>
      <% end %>
    </tr>

    <% if @unitofworks %>
      <% @unitofworks.each do |unit| %>
        <tr>
          <td>
            <%= unit.name %>
          </td>
          <% @complexities.each do |c| %>
            <td style="text-align: center;">
              <% a = AbacusOrganization.where(:unit_or_work_id => unit.id,
                                              :organization_uow_complexity_id => c.id,
                                              :organization_technology_id => @ot.id,
                                              :organization_id => @organization.id).first %>
              <%= text_field_tag "abacus[#{unit.id}][#{c.id}]", a.nil? ? '' : a.value, :class => "span2" %>
            </td>
          <% end %>
        </tr>
      <% end %>
    <% end %>
  </table>

  <%= submit_tag I18n.t('save'), :class => 'btn' %>
  <%= submit_tag I18n.t('apply'), :class => 'btn' %>
  <a href="#myImportModal" role="button" class="btn" data-toggle="modal">Import</a>
  <%= link_to "Export", export_abacus_path(@organization.id), :class => 'btn' %>

<% end %>

<div id="myImportModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <%= form_tag import_abacus_path(@organization.id), :multipart => true, :class => 'simple_form' do %>
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
      <h3 id="myModalLabel"><%= I18n.t(:import) %> Organization Abacus</h3>
    </div>
    <div class="modal-body">
      <label><%= I18n.t(:file_xls) %></label>
      <%= file_field_tag :file %>
    </div>
    <div class="modal-footer">
      <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
      <%= submit_tag I18n.t(:import), :class => 'btn btn-primary', :onclick => "$('.loading').show();" %>
    </div>
    <div class="loading span11 hide">
      <h4><%= I18n.t(:please_wait_import) %><%= image_tag 'ajax-loader.gif' %> </h4>
    </div>
  <% end %>
</div>
