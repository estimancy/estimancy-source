<script>
  $(document).ready(function() {

    var can_promote = "<%= local_assigns[:can] %>"

    <%# @project = local_assigns[:prj] || @project %>

    function send_notice(message, s1, s2){
      if(message == "ok"){
        return true;
      }
      else if(message == "ko"){
        if(can_promote != "admin_project_state"){
            alert("<%= I18n.t(:error_project_state_not_possible, :value_a => @s1, :value_b => @s2) %>");
          return false;
        }
        else{
          return confirm("<%= I18n.t(:warning_project_state_unnormal, :value_a => @s1, :value_b => @s2) %>");
        }
      }
      else{
        return confirm(message);
      }
    }

    $(".submit_project").click(function() {
      old_value = "<%= @project.state %>"
      new_value = $("#project_state").val();
      r = ""

      if (old_value != new_value) {
        switch (old_value)
        {
          case "preliminary":
            switch (new_value) {
              case "in_progress":
                return send_notice("ok");
                break;
              case "in_review":
                return send_notice("<%= I18n.t(:warning_project_state_to_inreview, :value_b => 'IN REVIEW') %>");
                break;
              case "checkpoint":
                return send_notice("<%= I18n.t(:warning_project_state_to_checkpoint, :value_b => 'CHECKPOINT') %>");
                break;
              case "released":
                return send_notice("<%= I18n.t(:warning_project_state_to_released, :value_b => 'RELEASED') %>");
                break;
              case "rejected":
                return send_notice("<%= I18n.t(:warning_project_state_to_rejected, :value_b => 'REJECTED') %>");
                break;
            }
            break;
          case "in_progress":
            switch (new_value) {
              case "preliminary":
                return send_notice("ok");
                break;
              case "in_review":
                return send_notice("<%= I18n.t(:warning_project_state_to_inreview, :value_b => 'IN REVIEW') %>");
                break;
              case "checkpoint":
                return send_notice("<%= I18n.t(:warning_project_state_to_checkpoint, :value_b => 'CHECKPOINT') %>");
                break;
              case "released":
                return send_notice("<%= I18n.t(:warning_project_state_to_released, :value_b => 'RELEASED') %>");
                break;
              case "rejected":
                return send_notice("<%= I18n.t(:warning_project_state_to_rejected, :value_b => 'REJECTED') %>");
                break;
            }
          case "in_review":
            switch (new_value) {
              case "preliminary":
                send_notice("ok");
                break;
              case "in_progress":
                send_notice("ok");
                break;
              case "checkpoint":
                return send_notice("<%= I18n.t(:warning_project_state_to_checkpoint, :value_b => 'CHECKPOINT') %>");
                break;
              case "released":
                 return send_notice("<%= I18n.t(:warning_project_state_to_released, :value_b => 'RELEASED') %>");
                 break;
              case "rejected":
                return send_notice("<%= I18n.t(:warning_project_state_to_rejected, :value_b => 'REJECTED') %>");
                break;
            }
          case "checkpoint":
            switch (new_value) {
              case "preliminary":
                return send_notice("ko",'CHECKPOINT','PRELIMINARY');
                break;
              case "in_progress":
                return send_notice("ko",'CHECKPOINT','IN PROGRESS');
                break;
              case "in_review":
                return send_notice("ko",'CHECKPOINT','IN REVIEW');
                break;
              case "released":
                return send_notice("<%= I18n.t(:warning_project_state_to_released, :value_b => 'RELEASED') %>");
                break;
              case "rejected":
                return send_notice("<%= I18n.t(:warning_project_state_to_rejected, :value_b => 'REJECTED') %>");
                break;
            }
          case "released":
            switch (new_value) {
              case "preliminary":
                return send_notice("ko",'RELEASED','PRELIMINARY');
                break;
              case "in_progress":
                return send_notice("ko",'RELEASED','IN PROGRESS');
                break;
              case "in_review":
                return send_notice("ko",'RELEASED','IN REVIEW');
                break;
              case "checkpoint":
                return send_notice("<%= I18n.t(:warning_project_state_unusual, :value_a =>'RELEASED', :value_b => 'CHECKPOINT') %>");
                break;
              case "rejected":
                return send_notice("<%= I18n.t(:warning_project_state_to_rejected, :value_b => 'REJECTED') %>");
                break;
            }
          case "rejected":
            switch (new_value) {
              case "preliminary":
                return send_notice("ko",'REJECTED','PRELIMINARY');
                break;
              case "in_progress":
                return send_notice("ko",'REJECTED','IN PROGRESS');
                break;
              case "in_review":
                return send_notice("ko",'REJECTED','IN REVIEW');
                break;
              case "checkpoint":
                return send_notice("<%= I18n.t(:warning_project_state_unusual, :value_a =>'REJECTED', :value_b => 'CHECKPOINT') %>");
                break;
              case "released":
                return send_notice("<%= I18n.t(:warning_project_state_unusual, :value_a =>'REJECTED', :value_b => 'RELEASED') %>");
                break;
            }
        }
      }

    });
  });
</script>