<div class="position-relative">
  <div class="mb-4" style="background: #ECEFF2;">
    <div class="container">
      <div class="widgets-list">
        <div class="d-flex justify-content-between pt-5 pb-4">
          <h2>Résultats après calculs</h2>
          <button class="btn btn-primary dropdown-toggle pull-right" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Ajouter une vignette
          </button>
        </div>
        <div class="widget-list-content">
          <div class="widget-group">
            <div class="widget-group-label"><span>Groupe A</span></div>
            <ul class="widget-group-list">
              <li>
                <div class="card card-widget card-indicator card-indicator-with-module-dark">
                  <div class="card-body">
                    <div class="card-indicator-type">Point de fonction</div>
                    <div class="card-indicator-text">Effort Brut</div>
                    <div class="card-indicator-quantity"><span>15</span> p.f</div>
                  </div>
                </div>
              </li>
              <li>
                <div class="card card-widget card-indicator card-indicator-with-module-dark">
                  <div class="card-body">
                    <div class="card-indicator-type">Trans PF j.h</div>
                    <div class="card-indicator-text">Effort Brut</div>
                    <div class="card-indicator-quantity">
                      <span>8 545</span> j.h</div>
                  </div>
                </div>
              </li>
            </ul>
          </div>
          <div class="widget-group">
            <div class="widget-group-label"><span>Groupe B</span></div>
            <ul class="widget-group-list">
              <li>
                <div class="card card-widget card-indicator card-indicator-with-module">
                  <div class="card-body">
                    <div class="card-indicator-type">Time Cost Trade</div>
                    <div class="card-indicator-text">Effort Brut</div>
                    <div class="card-indicator-quantity"><span>20</span> semaines</div>
                  </div>
                </div>          </li>
              <li>
                <div class="card card-widget card-indicator card-indicator-with-module">
                  <div class="card-body">
                    <div class="card-indicator-type">Time Cost Trade</div>
                    <div class="card-indicator-text">Effort Brut</div>
                    <div class="card-indicator-quantity"><span>1,2</span> personnes</div>
                  </div>
                </div>          </li>
              <li>
                <div class="card card-widget card-indicator card-indicator-with-module">
                  <div class="card-body">
                    <div class="card-indicator-type">ISBSG</div>
                    <div class="card-indicator-text">Effort Brut</div>
                    <div class="card-indicator-quantity"><span>43</span> j.h</div>
                  </div>
                </div>
              </li>
              <li>
                <div class="card card-widget card-indicator card-indicator-with-module">
                  <div class="card-body">
                    <div class="card-indicator-type">ISBSG</div>
                    <div class="card-indicator-text">Effort Brut</div>
                    <div class="card-indicator-quantity"><span>104</span> %</div>
                  </div>
                </div>
              </li>
              <li>
                <div class="card card-widget card-indicator card-indicator-with-module">
                  <div class="card-body">
                    <div class="card-indicator-type">Cycle du projet</div>
                    <div class="card-indicator-text">Effort Brut</div>
                    <div class="card-indicator-quantity"><span>15</span> p.f</div>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="mb-5">
      <div class="effort-bloc">
        <ul class="nav nav-pills tabs">
          <li class="nav-item">
            <a class="nav-link active" href="#">Effort par phase</a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="#">Effort par coût</a>
          </li>
        </ul>
        <div class="card card-widget">
        <div class="card-body">
          <div class="effort-bloc-tools d-flex justify-content-end mb-2">
            <a href="#"><i class="material-icons">get_app</i></a>
            <a href="#"><i class="material-icons">edit</i></a>
            <a href="#"><i class="material-icons">delete</i></a>
          </div>
          <div class="effort-table">
            <table class="table" style="width:100%">
              <thead>
              <tr>
                <th>Phase</th>
                <th>Analyste</th>
                <th>Architecte</th>
                <th>Testeur</th>
                <th>MOA</th>
                <th>A.Q</th>
                <th>CP</th>
                <th>G.Conf</th>
                <th>Total Effort retenu  (j.h)</th>
              </tr>
              </thead>
              <tbody>
              <tr>
                <td>Cycle de vie en V FR/OS</td>
                <td>8</td>
                <td>54</td>
                <td>22</td>
                <td>129</td>
                <td>102</td>
                <td>84</td>
                <td>48</td>
                <td>447</td>
              </tr>
              <tr>
                <td>Spécifications générales</td>
                <td>8</td>
                <td>54</td>
                <td>22</td>
                <td>129</td>
                <td>102</td>
                <td>84</td>
                <td>48</td>
                <td>447</td>
              </tr>
              <tr>
                <td>Spécifications détaillées</td>
                <td>8</td>
                <td>54</td>
                <td>22</td>
                <td>129</td>
                <td>102</td>
                <td>84</td>
                <td>48</td>
                <td>447</td>
              </tr>
              <tr>
                <td>Réalisation / Tests unitaires</td>
                <td>8</td>
                <td>54</td>
                <td>22</td>
                <td>129</td>
                <td>102</td>
                <td>84</td>
                <td>48</td>
                <td>447</td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      </div>
    </div>

    <div class="mb-5">
      <div class="effort-chart-bloc card card-widget">
        <div class="card-body">
          <h3>Répartition effort par activités</h3>    <div class="effort-chart mt-4 mb-4">
          <div class="effort-chart-canvas"><canvas id="pieCanvas" width="280" height="280"></canvas></div>
          <div class="effort-chart-legend" id="pieLegend"><div><span class="legend-color" style="background-color:#007DAB;">&nbsp;</span> Réalisation / Test Unitaires<span class="legend-percent">(41%)</span></div><div><span class="legend-color" style="background-color:#0099C9;">&nbsp;</span> Gestion de projet<span class="legend-percent">(22%)</span></div><div><span class="legend-color" style="background-color:#84CEE5;">&nbsp;</span> Intégration et Tests<span class="legend-percent">(20%)</span></div><div><span class="legend-color" style="background-color:#CFD8DC;">&nbsp;</span> Autre<span class="legend-percent">(17%)</span></div></div>
        </div>
        </div>
      </div>

      <script>

          var myCanvas = document.getElementById("pieCanvas");
          var myLegend = document.getElementById("pieLegend");
          myCanvas.width = 280;
          myCanvas.height = 280;

          var ctx = myCanvas.getContext("2d");

          function drawPieSlice(ctx,centerX, centerY, radius, startAngle, endAngle, color ){
              ctx.fillStyle = color;
              ctx.beginPath();
              ctx.moveTo(centerX,centerY);
              ctx.arc(centerX, centerY, radius, startAngle, endAngle);
              ctx.closePath();
              ctx.fill();
          }

          // Pie chart
          var Piechart = function(options){
              this.options = options;
              this.canvas = options.canvas;
              this.ctx = this.canvas.getContext("2d");
              this.colors = options.colors;

              this.draw = function(){
                  var total_value = 0;
                  var color_index = 0;
                  for (var categ in this.options.data){
                      var val = this.options.data[categ];
                      total_value += val;
                  }

                  var start_angle = 0;
                  for (categ in this.options.data){
                      var val = this.options.data[categ];
                      var slice_angle = 2 * Math.PI * val / total_value;

                      drawPieSlice(
                          this.ctx,
                          this.canvas.width/2,
                          this.canvas.height/2,
                          Math.min(this.canvas.width/2,this.canvas.height/2),
                          start_angle,
                          start_angle+slice_angle,
                          this.colors[color_index%this.colors.length]
                      );

                      start_angle += slice_angle;
                      color_index++;
                  }

                  if (this.options.legend){
                      color_index = 0;
                      var legendHTML = "";
                      for (categ in this.options.data){
                          var val = this.options.data[categ];
                          legendHTML += "<div><span class='legend-color' style='background-color:"+this.colors[color_index++]+";'>&nbsp;</span> "+categ+"<span class='legend-percent'>("+Math.round(100 * val / total_value)+"%)</span></div>";
                      }
                      this.options.legend.innerHTML = legendHTML;
                  }
              };
          };

          var myVinyls = {
              "Réalisation / Test Unitaires": 41,
              "Gestion de projet": 22,
              "Intégration et Tests": 20,
              "Autre": 17
          };

          var myPiechart = new Piechart(
              {
                  canvas:myCanvas,
                  data:myVinyls,
                  colors:["#007DAB","#0099C9", "#84CEE5","#CFD8DC"],
                  legend:myLegend
              }
          );
          myPiechart.draw();
      </script>
    </div>
  </div>
</div>


<%= hidden_field_tag :project_id, @project.id %>
<%= render 'dashboard_inner' %>