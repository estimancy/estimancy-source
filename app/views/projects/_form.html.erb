<% action_name = controller.action_name %>
<% if ["new", "edit"].include?(action_name) %>
  <h2><%= ("#{action_name}" == "new")? "#{I18n.t "new_project"}" : "#{I18n.t "edit_project"}: #{@project.title}"%></h2>
<% else %>
  <h1><%= I18n.t(:new_project)%></h1>
<% end %>


<%= simple_form_for(@project) do |f| %>
    <%= f.error_notification %>

<div class="tabs">
  <ul>
    <li><a href="#tabs-1"><%= I18n.t(:global_properties)%></a></li>
    <% if action_name == "edit" %>
      <li><a href="#tabs-2">WBS-Product </a></li>
      <li><a href="#tabs-3">WBS-Activity </a></li>
      <li><a href="#tabs-4"><%= I18n.t(:estimation_plan)%></a></li>
      <li><a href="#tabs-5"><%= I18n.t(:securities)%></a></li>
      <li><a href="#tabs-6"><%= I18n.t(:calendar)%> </a></li>
      <li><a href="#tabs-7"><%= I18n.t(:resources)%> </a></li>
      <li><a href="#tabs-8"><%= I18n.t(:analyse)%> </a></li>
    <% end %>
  </ul>


  <div id="tabs-1">

    <%= f.input :title, :label => "#{I18n.t "name"}", :input_html => { :class => 'input-xxlarge' } %>

    <%= f.input :description, :label => "#{I18n.t "description"}", :input_html => { :class => 'input-xxlarge' } %>

    <%= f.input :alias, :input_html => { :class => 'input-xxlarge' } %>

    <%= f.input :state, :label => "#{I18n.t "state"}", :label => "#{I18n.t "state"}", :as => :select, :collection => @project.states, :input_html => { :class => 'input-xxlarge' } %>

    <%= f.input :start_date, :label => "#{I18n.t "start_date"}", :as => :date, :start_year => Date.today.year, :end_year => Date.today.year, :discard_day => true do %>
      <%= f.text_field :start_date, :class => 'datepicker input-xxlarge', :onclick => "$(this).datepicker();", :value => Time.now.strftime("%d/%m/%y") %>
    <% end %>

    <%= f.input :organization_id, :label => "#{I18n.t "organization"}", :as => :select, :collection => @organizations, :input_html => { :class => 'input-xxlarge' }  %>

    <%= f.input :project_area_id, :label => "#{I18n.t "project_area"}", :as => :select, :collection => @project_areas, :input_html => { :class => 'input-xxlarge' }  %>

    <%= f.input :acquisition_category_id, :label => "#{I18n.t "acquisition_category"}", :as => :select, :collection => @acquisition_categories, :input_html => { :class => 'input-xxlarge' }  %>

    <%= f.input :platform_category_id, :label => "#{I18n.t "platform_category"}", :as => :select, :collection => @platform_categories, :input_html => { :class => 'input-xxlarge' }  %>

    <%= f.input :project_category_id, :label => "#{I18n.t "project_category"}", :as => :select, :collection => @project_categories, :input_html => { :class => 'input-xxlarge' }  %>

    <div class="actions">
      <%= f.submit "Save", :class => "btn" %>
      <%= f.submit "Apply", :class => "btn" %>
    </div>

    <% end %>
  </div>

  <% unless action_name == "new" or action_name == "create" %>

    <div id="tabs-2">
       <div class="component_tree" id="project_wbs_product_section">
         <% unless @project.nil? || @pe_wbs_project_product.nil? %>
           <%=raw generate_wbs(@pe_wbs_project_product.pbs_project_elements.last.root, @project, "", 5) unless @pe_wbs_project_product.pbs_project_elements.last.nil? %>
         <% end %>
       </div>
    </div>

    <div id="tabs-3">
      <% unless @project.nil? || @pe_wbs_project_activity.nil? %>
          <div class="well component_tree">
            <%= form_tag "/add_wbs_activity_to_project", :method => :post, :id => "form_select_and_add_wbs_activity", :remote => true do %>
                <p style="margin: 10px; ">
                  <label>WBS-Activities table:</label>
                  <%= select_tag "wbs_activity_element", options_for_select(@wbs_activity_elements.map{|i| [i.wbs_activity.name, i.id] } ), :prompt => 'Select a WBS-Activity...' %>
                  <%= hidden_field_tag :project_id,  @project.id  %>
                  <%= submit_tag "ADD", :class => "btn" %>
                </p>
            <% end %>
          </div>
      <% end %>

      <div class="show_list">
        <span class="pull-right">Show hidden element <%= check_box_tag "show_excluded_elt", true, false, :onchange => "refresh_me();", :remote => true %></span>  <br />
        <div  id="wbs_project_elements_section" class="component_tree">
            <%= render :partial => 'generate_wbs_project_elt_tree', :object => @pe_wbs_project_activity %>
        </div>
      </div>
    </div>

    <div id="tabs-4">
      <%= render :partial => "estimation_plan" %>
    </div>

    <div id="tabs-5">
      <h3>User securities resume</h3>
      <table class="table table-striped">
        <tr>
          <th>User name</th>
          <% ProjectSecurityLevel.all.each do |prj_level| %>
            <th><%= prj_level.name %></th>
         <% end %>
        </tr>
        <% @project.users.each do |user| %>
          <% securities = user.project_securities_for_select(@project.id) %>
          <tr>
             <td><%= user.name %>
             <% ProjectSecurityLevel.all.each do |prj_level| %>
               <td><%= radio_button_tag("user_securities_#{user.id}", prj_level.id, ((securities.nil? || securities.project_security_level.nil?) ? false : (securities.project_security_level.id == prj_level.id))) %> </td>
              <% end %>
          </tr>
        <% end %>
      </table>


      <h3>Group securities resume</h3>
      <table class="table table-striped">
        <tr>
          <th>Group name</th>
          <% ProjectSecurityLevel.all.each do |prj_level| %>
            <th><%= prj_level.name %></th>
         <% end %>
        </tr>
        <% @project.groups.each do |group| %>
          <% securities = group.project_securities_for_select(@project.id) %>
          <tr>
             <td><%= group.name %>
             <% ProjectSecurityLevel.all.each do |prj_level| %>
               <td><%= radio_button_tag("group_securities_#{group.id}", prj_level.id, (securities.nil? ? false : (securities.project_security_level.id == prj_level.id))) %> </td>
            <% end %>
          </tr>
        <% end %>
      </table>
    </div>
  <% end %>

  <div id="tabs-6">
      <div style="clear: both"></div>
  </div>

  <div id="tabs-7">
      <div style="clear: both"></div>
  </div>

</div>
