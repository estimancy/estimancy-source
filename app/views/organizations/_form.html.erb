<div class="tabs">
  <ul>
    <li><a href="#tabs-organization"><%= I18n.t(:organizations) %> </a></li>
    <% if action_name.in?(%w(edit update)) %>
        <li><a href="#tabs-group"><%= I18n.t(:groups) %></a></li>
        <li><a href="#tabs-profile"><%= I18n.t(:profiles) %></a></li>
        <li><a href="#tabs-attribute"><%= I18n.t(:pe_attributes) %> </a></li>
        <li><a href="#tabs-technology"><%= I18n.t(:organization_technology) %> </a></li>
        <li><a href="#tabs-uow"><%= I18n.t(:organization_unit_of_work) %> </a></li>
        <!--<li><a href="#tabs-cplx-uow"><%= I18n.t(:unit_of_work_complexity) %> </a></li>-->
        <li><a href="#tabs-synthesis-uow-techno"><%= I18n.t(:technology_uow_synthesis) %></a></li>
        <li><a href="#tabs-sut"><%= I18n.t(:size_unit_type) %></a></li>
        <li><a href="#tabs-abacus-tsu"><%= I18n.t(:technology_size_type_abacus) %></a></li>
        <li><a href="#tabs-abacus-sut"><%= I18n.t(:technology_size_abacus) %></a></li>
        <li><a href="#tabs-sub"><%= I18n.t(:organization_subcontractor) %> </a></li>
        <li><a href="#tabs-cplx-factor"><%= I18n.t(:factor_complexity) %> </a></li>
        <li><a href="#tabs-estimations-statuses"><%= I18n.t(:estimations_statuses) %> </a></li>
  <% end %>
  </ul>

  <div id="tabs-organization">
    <%= simple_form_for(@organization) do |f| %>
      <div>
        <%= f.input :name, :label => I18n.t('name'), :input_html => {:class => 'input-xxlarge', :autofocus => (controller.action_name == 'new')} %>
        <%= f.input :description, :label => I18n.t('description'), :input_html => {:class => 'input-xxlarge', :rows => 5} %>
      </div> <br />

      <div id="accordion2" class="accordion">
        <div class="accordion-group accordion-caret">
          <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo">
              <i class="icon-caret-down"></i>
              <b><%= I18n.t(:text_measuring_units) %></b>
            </a>
          </div>
          <div id="collapseTwo" class="accordion-body in collapse">
              <div class="accordion-inner">
                <%= f.input :number_hours_per_day, :label => I18n.t('number_hours_per_day'), :required => true, :input_html => {:class => 'input-xxlarge'} %>
                <%= f.input :number_hours_per_month, :label => I18n.t('number_hours_per_month'), :required => true, :input_html => {:class => 'input-xxlarge'} %>
                <%= f.input :currency_id, :as => :select, collection: Currency.defined_or_local.map{|i| ["#{i.name} (#{i.sign})", i.id]}, :label => I18n.t(:currency), :required => true %>
                <%= f.input :cost_per_hour, :label => I18n.t('cost_per_hour'), :required => true, :input_html => {:class => 'input-xxlarge'} %>
                <%= f.input :inflation_rate, :label => I18n.t('inflation_rate'), :required => true, :input_html => {:class => 'input-xxlarge'} %>
              </div>
          </div>
        </div>
      </div>

        <div class="actions-tabs">
          <% if can? :edit_organizations, Organization %>
              <% if action_name == 'edit' %>
                  <%= submit_tag I18n.t('save'), :class => 'btn' %>
              <% end %>
              <%= submit_tag I18n.t('apply'), :class => 'btn' %>
          <% end %>
          <%= link_to I18n.t('back'), organizationals_params_path, :class => 'btn' %>
        </div>
    <% end %>
  </div>

  <% if action_name.in?(%w(edit update)) %>

    <div id="tabs-group">
      <b><%= I18n.t(:groups) %></b>
      <%= render :partial => 'organizations/groups' %>
    </div>


    <div id="tabs-profile">
      <b><%= I18n.t(:profiles) %></b>
      <%= render :partial => 'organizations/profiles' %>
      <br><br>
    </div>

    <div id="tabs-attribute">
      <b><%= I18n.t(:text_organization_attributes) %></b>
      <br><br>
      <!-- Method in AttributeOrganizationsController -->
      <%= form_tag('/update_selected_attribute_organizations', :method => 'POST', :class => 'simple_form') do -%>

          <%= hidden_field_tag 'organization_id', @organization.id %>
          <%= hidden_field_tag 'organization[pe_attribute_ids][]' %>

          <table id="table_list_2" class="table tablesorterPager table-striped table-bordered table-condensed">
            <thead>
            <tr>
              <th><%= I18n.t(:pe_attribute_name) %></th>
              <th class="filter-select"><%= I18n.t(:selected) %></th>
              <th class="filter-select"><%= I18n.t(:attribute_categories) %></th>
              <th><%= I18n.t(:description) %></th>
              <th><%= I18n.t(:mandatory) %></th>
            </tr>
            </thead>
            <tbody>
            <% @attributes.each do |attr| %>
                <tr>
                  <td><%= link_to(attr.name, edit_pe_attribute_path(attr), :class => 'attribute_tooltip', :style => 'color:green;', :title => display_attribute_rule(attr)) unless attr.nil? %></td>
                  <td style="text-align: center">
                    <span class="hidden">
                      <%= @attribute_settings.map(&:pe_attribute_id).include?(attr.id).to_s.humanize %>
                    </span>
                    <%= check_box_tag 'organization[pe_attribute_ids][]', attr.id, @attribute_settings.map(&:pe_attribute_id).include?(attr.id) %>
                  </td>
                  <td><%= attr.attribute_category %></td>
                  <td><%= attr.description %></td>
                  <td class="center">
                    <% ao = AttributeOrganization.where("organization_id = ? AND pe_attribute_id = ?", @organization.id, attr.id).first %>
                    <%= select_tag "is_mandatory[#{attr.id}]", options_for_select([["#{I18n.t('simple_form.yes')}", true], ["#{I18n.t('simple_form.no')}", false]], :selected => (ao.nil? ? nil : ao.is_mandatory)), :prompt => I18n.t('helpers.select.prompt'), :class => 'input-small' %>
                  </td>
                </tr>
            <% end %>
            <%= render :partial => 'layouts/footer_table' %>
            </tbody>
          </table>
          <% if can? :edit_organizations, Organization %>
              <%= submit_tag I18n.t('save'), :class => 'btn' %>
              <%= submit_tag I18n.t('apply'), :class => 'btn' %>
          <% end %>
          <span class="on_success_attr"></span>
      <% end -%>
    </div>

    <div id="tabs-technology">
      <b><%= I18n.t(:text_organization_technology) %></b>
      <br>
      <% if can? :edit_organizations, Organization %>
          <%= link_to I18n.t('new_organization_technology'), new_organization_technology_path(:organization_id => @organization.id), :class => 'btn pull-right' %>
      <% end %>
      <table id="table_list_4" class="table tablesorterPager table-striped table-bordered table-condensed">
        <thead>
        <tr>
          <th><%= I18n.t(:name) %></th>
          <th><%= I18n.t(:alias) %></th>
          <th><%= I18n.t(:description) %></th>
          <th><%= I18n.t(:productivity_ratio) %></th>
          <th class="action" colspan="2"><%= I18n.t(:actions) %></th>
        </tr>
        </thead>
        <tbody>
        <% @organization.organization_technologies.each do |ot| %>
            <% if ot.state == 'retired' %>
                <tr style="font-style:italic; color:Red">
            <% elsif ot.state == 'draft' %>
                <tr style="font-style:italic; color:DarkOrange ">
            <% else %>
                <tr>
            <% end %>
            <td><%= ot.name %></td>
            <td><%= ot.alias %></td>
            <td><%= ot.description %></td>
            <td><%= ot.productivity_ratio %></td>
            <td class="align-center">
              <%= link_to '', edit_organization_technology_path(ot.id, :organization_id => @organization.id), :class => 'icon-pencil', :title => I18n.t('edit') %>
              <% if can? :manage, Organization %>
                  <%= link_to '', ot, confirm: I18n.t('are_you_sure'), method: :delete, :class => 'icon-remove', :style => 'color:red', :title => I18n.t('delete') %>
              <% end %>
            </td>
            </tr>
        <% end %>

        <%= render :partial => 'layouts/footer_table' %>
        </tbody>
      </table>
    </div>

    <div id="tabs-uow">
      <b><%= I18n.t(:text_organization_unit_of_work) %></b>
      <br>
      <% if can? :edit_organizations, Organization %>
        <%= link_to I18n.t('new_unit_of_work'), new_unit_of_work_path(:organization_id => @organization.id), :class => 'btn pull-right' %>
      <% end %>
      <table id="table_list_6" class="table tablesorterPager table-striped table-bordered table-condensed">
        <thead>
        <tr>
          <th><%= I18n.t(:name) %></th>
          <th><%= I18n.t(:alias) %></th>
          <th><%= I18n.t(:description) %></th>
          <th class="action" colspan="2"><%= I18n.t(:actions) %></th>
        </tr>
        </thead>
        <tbody>
        <% @unitofworks.each do |uow| %>
          <% if uow.state == 'retired' %>
            <tr style="font-style:italic; color:Red">
          <% elsif uow.state == 'draft' %>
            <tr style="font-style:italic; color:DarkOrange ">
          <% else %>
            <tr>
          <% end %>
          <td><%= uow.name %></td>
          <td><%= uow.alias %></td>
          <td><%= uow.description %></td>
          <td class="align-center">
            <%= link_to '', edit_unit_of_work_path(uow.id, :organization_id => @organization.id), :class => 'icon-pencil', :title => I18n.t('edit') %>
            <% if can? :manage, Organization %>
              <%= link_to '', uow, confirm: I18n.t('are_you_sure'), method: :delete, :class => 'icon-remove', :style => 'color:red', :title => I18n.t('delete') %>
            <% end %>
          </td>
          </tr>
        <% end %>

        <%= render :partial => 'layouts/footer_table' %>
        </tbody>
      </table>
    </div>

  <div id="tabs-synthesis-uow-techno">
    <%= render :partial => 'organizations/technology_uow_synthesis' %>
  </div>

  <div id="tabs-sut">
    <% if can? :manage, Organization %>

      <%= link_to I18n.t('new_size_unit_type'), new_size_unit_type_path(:organization_id => @organization.nil? ? nil : @organization.id), :class => 'btn pull-right' %>

      <table id="table_list_4" class="table tablesorterPager table-striped table-bordered table-condensed">
        <thead>
          <tr>
            <th><%= I18n.t(:name) %></th>
            <th><%= I18n.t(:alias) %></th>
            <th><%= I18n.t(:description) %></th>
            <th class="action"><%= I18n.t(:actions) %></th>
          </tr>
        </thead>

        <tbody>
        <% @size_unit_types.each do |i| %>
          <tr>
            <td><%= i.name %></td>
            <td><%= i.alias %></td>
            <td><%= i.description %></td>
            <td class="align-center">
              <%= link_to '', edit_size_unit_type_path(i, organization_id: @organization.id), :class => 'icon-pencil', :title => I18n.t('edit') %>
              <%= link_to '', i, confirm: I18n.t('are_you_sure'), method: :delete, :class => 'icon-remove', :style => 'color:red', :title => I18n.t('delete') %>
            </td>
          </tr>
        <% end %>
        <%= render :partial => 'layouts/footer_table' %>
        <tbody>
        </table>
    <% end %>
  </div>

  <div id="tabs-abacus-sut">
    <%= render :partial => 'organizations/technology_size_type_abacus' %>
  </div>

  <div id="tabs-abacus-tsu">
    <%= render :partial => 'organizations/technology_size_unit_abacus' %>
  </div>

  <div id="tabs-sub">
    <b><%= I18n.t(:text_organization_subcontractor) %></b>
    <br>
    <% if can? :edit_organizations, Organization %>
      <%= link_to I18n.t('new_subcontractor'), new_subcontractor_path(:organization_id => @organization.id), :class => 'btn pull-right' %>
    <% end %>
    <table id="table_list_7" class="table tablesorterPager table-striped table-bordered table-condensed">
      <thead>
        <tr>
          <th><%= I18n.t(:name) %></th>
          <th><%= I18n.t(:alias) %></th>
          <th><%= I18n.t(:description) %></th>
          <th class="filter-select" title="<%= I18n.t(:tooltip_state) %>"><%= I18n.t(:state) %></th>
          <th class="action" colspan="2"><%= I18n.t(:actions) %></th>
        </tr>
      </thead>
      <tbody>
      <% @organization.subcontractors.each do |ot| %>
        <% if ot.state == 'retired' %>
          <tr style="font-style:italic; color:Red">
        <% elsif ot.state == 'draft' %>
          <tr style="font-style:italic; color:DarkOrange ">
        <% else %>
          <tr>
        <% end %>
        <td><%= ot.name %></td>
        <td><%= ot.alias %></td>
        <td><%= ot.description %></td>
        <td><%= ot.state %></td>
        <td class="align-center">
          <% unless ot.in?(@default_subcontractors) %>
            <%= link_to '', edit_subcontractor_path(ot.id, :organization_id => @organization.id), :class => 'icon-pencil', :title => I18n.t('edit') %>
            <% if can? :manage, Organization %>
              <%= link_to '', ot, confirm: I18n.t('are_you_sure'), method: :delete, :class => 'icon-remove', :style => 'color:red', :title => I18n.t('delete') %>
            <% end %>
          <% end %>
        </td>
        </tr>
      <% end %>

      <%= render :partial => 'layouts/footer_table' %>
      </tbody>
    </table>
  </div>

  <div id="tabs-cplx-factor">
    <h4>Factors Complexities</h4>

    <br>

    <% if can? :edit_organizations, Organization %>
      <%= link_to I18n.t('new_factor_complexity'), new_organization_uow_complexity_path(:organization_id => @organization.nil? ? nil : @organization.id, :anchortab => 'tabs-7'), :class => 'btn pull-right' %>
    <% end %>


    <% @factors.each do |factor| %>

      <h4>
        <%= factor.factor_type.nil? ? "" : factor.factor_type.humanize %> - <%= factor.name %> - <%= factor.description %>
      </h4>

      <table class="table">
        <% factor.organization_uow_complexities.where(organization_id: @organization.id).order('display_order ASC').each do |c| %>
          <tr style="<%= (c.is_default == true) ? 'color: blue;' : '' %>">
            <td class="span2"><%= c.name %></td>
            <td class="span2"><%= c.value %></td>
            <td>
              <%= link_to '', set_default_path(c), :class => 'icon-exclamation icon-large pull-left', :title => I18n.t('edit') %>
              <% if can? :edit_organizations, Organization %>
                <%= link_to '', new_organization_uow_complexity_path(:organization_id => @organization.nil? ? nil : @organization.id, factor: factor.id), :class => 'icon-plus-sign icon-large pull-left' %>
              <% end %>
              <%= link_to '', edit_organization_uow_complexity_path(c), :class => 'icon-pencil icon-large pull-left', :title => I18n.t('edit') %>
              <%= link_to '', c, confirm: I18n.t('are_you_sure'), method: :delete, :class => 'icon-remove icon-large pull-left', :style => 'color:red', :title => I18n.t('delete') %>
              <% if is_master_instance? && !c.is_local_record? %>
                <% if c.is_retired? %>
                  <%= link_to('', "/organization_uow_complexities/#{c.id}/restore_change", confirm: I18n.t('restoring'), :class => 'icon-undo icon-large pull-left', :style => 'color:orange', :title => I18n.t('restore_title')) %>
                <% else %>
                  <% unless c.is_defined? %>
                    <%= link_to('', "/organization_uow_complexities/#{c.id}/validate_change", confirm: I18n.t('validation'), :class => 'icon-ok icon-large pull-left', :style => 'color:green', :title => I18n.t('validate_title')) %>
                  <% end %>
                <% end %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </table>
    <% end %>
  </div>

 <div id="tabs-estimations-statuses" style="min-height: 50px;">
   <b><%#= I18n.t(:manage_estimations_statuses_workflow) %></b>
   <br>
   <% if can? :edit_organizations, Organization %>
       <%= link_to I18n.t('new_estimation_status'), new_estimation_status_path(:organization_id => @organization.id), :class => 'btn pull-right' %>
   <% end %>
   <%= render "estimation_statuses/statuses_management", object: @organization %>
 </div>

<% end %>
</div>

