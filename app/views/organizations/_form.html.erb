<div class="tabs">
  <ul>
    <li><a href="#tabs-1"><%= I18n.t(:organizations) %> </a></li>
    <% if action_name == "edit" %>
      <li><a href="#tabs-2"><%= I18n.t(:pe_attributes) %> </a></li>
      <li><a href="#tabs-3"><%= I18n.t(:attributes_settings) %> </a></li>
    <% end %>
  </ul>

  <div id="tabs-1">
    <%= simple_form_for(@organization) do |f| %>

        <%= f.input :name, :label => I18n.t('name'), :input_html => {:class => 'input-xxlarge', :autofocus => (controller.action_name == 'new')} %>
        <%= f.input :description, :label => I18n.t('description'), :input_html => {:class => 'input-xxlarge', :rows => 5} %>

        <div class="actions-tabs">
          <% if action_name == 'edit' %>
              <%= submit_tag I18n.t('save'), :class => 'btn' %>
          <% end %>
          <%= submit_tag I18n.t('apply'), :class => 'btn' %>
          <%= link_to I18n.t('back'), organizationals_params_path, :class => 'btn' %>
        </div>
    <% end %>
  </div>

  <% if action_name == "edit" %>
    <div id="tabs-2">
      <b><%= I18n.t(:text_organization_attributes) %></b>
      <br><br>
      <!-- Method in AttributeOrganizationsController -->
      <%= form_tag('/update_selected_attribute_organizations', :method => 'POST', :class => 'simple_form') do -%>

          <%= hidden_field_tag 'organization_id', @organization.id %>
          <%= hidden_field_tag 'organization[pe_attribute_ids][]' %>

          <table class="table table-striped table-bordered table-condensed">
            <tr>
              <th><%= I18n.t(:pe_attribute_name) %></th>
              <th><%= I18n.t(:selected) %></th>
              <th><%= I18n.t(:description) %></th>
            </tr>
            <% @attributes.each do |attr| %>
                <tr class="<%= cycle('even', 'odd') %>">
                  <td><%= link_to(attr.name, edit_pe_attribute_path(attr), :class => 'attribute_tooltip', :style => 'color:green;', :title => display_attribute_rule(attr)) unless attr.nil? %></td>
                  <td><%= check_box_tag 'organization[pe_attribute_ids][]', attr.id, @attribute_settings.map(&:pe_attribute_id).include?(attr.id) %>
                  <td><%= attr.description %></td>
                </tr>
            <% end %>
          </table>
          <%= submit_tag I18n.t('save'), :class => 'btn' %>
          <%= submit_tag I18n.t('apply'), :class => 'btn' %>
          <span class="on_success_attr"></span>
      <% end -%>
    </div>

    <div id="tabs-3">
      <!-- Method in AttributeOrganizationsController -->
      <%= form_tag('/update_attribute_organizations_settings', :method => 'POST', :class => 'simple_form') do -%>

          <%= hidden_field_tag 'organization_id', @organization.id %>
          <%= hidden_field_tag 'organization[pe_attribute_ids][]' %>

          <table class="table table-striped table-bordered table-condensed">

            <tr>
              <th style="text-align:left"><%= I18n.t(:name) %></th>
              <th style="text-align:left"><%= I18n.t(:mandatory) %></th>
            </tr>

            <% @attribute_settings.each_with_index do |ao, i| %>
                <%= hidden_field_tag 'attributes[]', ao.pe_attribute_id %>
                <tr>
                  <td class="span3"><%= link_to ao.pe_attribute.nil? ? '-' : ao.pe_attribute.name, '#', :class => 'attribute_tooltip', :style => 'color:green;', :title => display_attribute_rule(ao.pe_attribute) %></td>
                  <td><%= select_tag 'is_mandatory[]', options_for_select([['yes', true], ['no', false]], :selected => ao.is_mandatory), :prompt => I18n.t('helpers.select.prompt'), :class => 'input-small' %></td>
                </tr>
            <% end %>
          </table>

          <%= submit_tag I18n.t('save'), :class => 'btn' %>
          <%= submit_tag I18n.t('apply'), :class => 'btn' %>
          <span class="on_success_attr"></span>
      <% end -%>
    </div>
  <% end %>
</div>
